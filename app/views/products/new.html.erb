<% title 'Add a new product' %>
<style type="text/css">
select {
	width: 200px;
}
.price_range {
	text-decoration: underline;
	cursor: pointer;
	color: #000000;
	margin-right: 5px;
}

.product_target_audience {
	text-decoration: underline;
	cursor: pointer;
	color: #000000;
	margin-right: 5px;
}

.selected-price {
	font-weight: bold;
	color: #DA5D18;
}

.selected-audience {
	font-weight: bold;
	color: #DA5D18;
}

</style>
<script type="text/javascript"> 
    $(document).ready(function(){ 
        $(document).pngFix(); 

	    //Input Form placeholder
	    $('input:text').focus(function(){
	        if(this.value === this.defaultValue) {
	            this.value = "";
	        } else {
	            this.select();
	        }
	    })
	    .blur(function(){
	        if ($.trim(this.value) === "") {
	            this.value = (this.defaultValue ? this.defaultValue: "")
	        }
	    });
    }); 

	$(function() {
		$( "#product_name" ).autocomplete({
			source: function( request, response ) {
				$.ajax({
					url: "<%= products_path %>",
					dataType: "json",
					data: {
						search: request.term
					},
					success: function( data ) {
						response( $.map( data, function( item ) {
							return {
								label: item.product.name,
								value: item.product.name
							}
						}));
					}
				});
			},
			minLength: 2,
			select: function( event, ui ) {
				$(this).value(ui.item.label);
			},			
			open: function() {
				$(this).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
			},
			close: function() {
				$(this).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
			}
		});

		$( "#vendor_name" ).autocomplete({
			source: function( request, response ) {
				$.ajax({
					url: "<%= find_vendor_searches_path %>",
					dataType: "json",
					data: {
						query: request.term
					},
					success: function( data ) {
						response( $.map( data, function( item ) {
							return {
								label: item.vendor.name,
								value: item.vendor.name
							}
						}));
					}
				});
			},
			minLength: 2,
			select: function( event, ui ) {
				$(this).value(ui.item.label);
			},			
			open: function() {
				$(this).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
			},
			close: function() {
				$(this).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
			}
		});

		$("#my_collection_link img").click(function() {
			// Selected
			$(this).toggleClass('selected-product', true); 
			if ($(this).hasClass('selected-product')) {
				$(this).parents('li').removeClass('not-selected-product');
				$(this).parents('li').siblings().removeClass('selected-product');
				$(this).parents('li').siblings().addClass('not-selected-product');
				$('#my_collection_id').attr('value', $(this).attr("id"))
			} else {
				$(this).parents('li').addClass('not-selected-product');			
			}
		});

		$(".price_range").click(function() {
			// Selected
			$(this).toggleClass('selected-price');
			if ($(this).hasClass('selected-price')) {
				$(this).siblings().removeClass('selected-price');
				$('#product_product_link_attributes_price_range_id').attr('value', $(this).attr("id"));
			} else {
				$('#product_product_link_attributes_price_range_id').attr('value', "");
			}
		});

		$(".product_target_audience").click(function() {
			// Selected
			$(this).toggleClass('selected-audience');
			if ($(this).hasClass('selected-audience')) {
				$(this).siblings().removeClass('selected-audience');
				$('#product_product_target_audience_id').attr('value', $(this).attr("id"));
			} else {
				$('#product_product_target_audience_id').attr('value', "");
			}
		});

	});

</script>

<body class="subpage productpage">

<div id="grey-strip-signedin">
	<div class="wrapper-top">
		<%= render :partial => 'layouts/navigation', :locals => {:user => @user, :item => ""} %>						
	</div>
</div>

<%= form_for(@product, :html => {:multipart => true}) do |f| %>
<div class="wrapper-mh">
	<div class="add-product-maincol"> 
    	<div class="add-product-content">
			<!--
			<div class="add-product-methods">
				<ul>
					<li>
						Google<span><%= image_tag "auth/google_64.png", :size => "64x64", :alt => "Google" %></span>
					</li>
					<li class="alt">
						Facebook<span><%= image_tag "auth/facebook_64.png", :size => "64x64", :alt => "Facebook", :class => "social" %></span>
					</li>
					<li class="noborder">
						Open ID<span><%= image_tag "auth/open_id_64.png", :size => "64x64", :alt => "OpenID" %></span>
					</li>
					<li class="noborder alt">Twitter<span><%= image_tag "auth/twitter_64.png", :size => "64x64", :alt => "Twitter", :class => "social" %></span></li>
				</ul>
			</div>
			-->
			<div id="error_explanation" style="margin-left: 20px;">
				<%= f.error_messages %>
			</div>
			<div class="add-product-methods">				
				<br/>
				<h3>Add a new product</h3>
			  	<%= f.label :name %>
				<%= f.text_field :name, :class => "text", :placeholder => "e.g. iPad 3" %>
				<br/><br/>

			  	<%= f.label "Brand" %>
				<%= text_field_tag 'vendor_name', nil, :class => "text", :placeholder => "e.g. Apple Inc." %>
				<br/><br/>
				<%#= select_tag "product[vendor_id]", options_from_collection_for_select(Vendor.all, "id", "name") %>

			  	<%= f.label "Category" %>
				<%= collection_select(:product, :product_line_id, ProductLine.all, :id, :name, :prompt => true) %>
				<br/><br/>

				<%= f.label "For whom?" %>
				<% @product_target_audiences.each do |product_target_audience| %>  	
					<a class="product_target_audience" id="<%= product_target_audience.id %>"><%= product_target_audience.name %></a>
				<% end %>
				<br/><br/>

				<%= f.fields_for :product_link do |builder| %>					
				  	<%= f.label "Price" %>
					<% count = 1 %>
					<%# product_product_link_attributes_price_range_id %>
					<% @price_ranges.each do |price_range| %>
						<% if count == @price_ranges.size %>
						<a class="price_range" id="<%= price_range.id %>">$<%= price_range.from_price %>+</a>
						<% else %>
						<a class="price_range" id="<%= price_range.id %>">$<%= price_range.from_price %> - $<%= price_range.to_price %></a>
						<% end %>
						<% count = count + 1 %>
						<% if count == 5 %>
						<br/>
						<% end %>
					<% end %>
					<br/></br/>
					
				  	<%= f.label "Where to buy?" %>
					<%= builder.hidden_field :informer_id %>
					<%= builder.hidden_field :price_range_id %>
					<%= builder.text_field :link, :class => 'text', :placeholder => "http://" %>
					<br/><br/>
				<% end %>					

				<%= f.hidden_field :product_target_audience_id %>
				<%= hidden_field_tag :my_collection_id %>
				<%= hidden_field_tag :interest_indicator, MyCollectionItem::WISH %>
				<%= hidden_field_tag "product[uploader_id]", current_user.id %>
				
				<div>
			  		<%= f.label 'Upload a image' %>
					<%= f.file_field :thumbnail %>			
				</div>	
				<br/>

			  	<%= f.label :description %>
				<%= f.text_area :description, :cols => 70, :rows => 5, :class=> "answer_area" %>
				<br/><br/>

				<div class="actions">
					<%= f.submit 'Submit', :class => "submit-tip-button" %>
				</div>
				<br/>
			</div>
	    </div>
	</div>
	
	<!--div class="upload-image-sidebar"-->			
	<div class="sidebar"-->
		<div class="sidebar-content">
            <div class="sidebar-header">Add to your collection? [optional]</div>			
			<div id="question" class="product-grid" style="margin: 17px; border: 0px;">
		    	<ul>
				<% current_user.my_collections.each do |my_collection| %>
		  			<li id="<%= my_collection.id %>" class="not-selected-product">	
						<%= link_to '#', :id => 'my_collection_link' do %>	
							<% if !my_collection.thumbnail.present? && !my_collection.my_collection_items.nil? && my_collection.my_collection_items.size > 0 %>
								<% if my_collection.my_collection_items[0].product.thumbnail.present? %>
									<%= image_tag( my_collection.my_collection_items[0].product.thumbnail.url(:small), :size => "64x64", :class => "preview-image", :id => my_collection.id, :title => my_collection.name) %>
								<% elsif  my_collection.my_collection_items[0].product.image_url.present? %>
									<%= image_tag( my_collection.my_collection_items[0].product.image_url, :size => "64x64", :class => "preview-image", :id => my_collection.id, :title => my_collection.name) %>
								<% else %>
									<%= image_tag "/images/product/no-image_medium.jpg", :size => "64x64", :class => "preview-image", :id => my_collection.id, :title => my_collection.name %>
								<% end %>
							<% else %>
								<%= image_tag my_collection.thumbnail.url(:small), :size => "64x64", :class => "preview-image", :id => my_collection.id, :title => my_collection.name %>						
							<% end %>							
						<% end %>
					</li>
				<% end %>
				</ul>
			</div>
		</div>
	</div>

	<div class="sidebar"-->
		<div class="sidebar-content">
            <div class="sidebar-header" style="background: #dd6219;">Did you know?</div>			
			<div style="margin: 17px; border: 0px;">
				<h3 style="text-align:left;">There are always something EXTRA!</h3><br/>
				<div>
					<p style="font-size: 12px; font-family: Verdana;">
						You can bookmark any item you find to your Macabolic collections. Just drag the "To Macabolic" to your Bookmark bar now.<br/><br/>

						<span class="extra_to_macabolic">
							<a href="javascript:(function(){if(window.myBookmarklet!==undefined){myBookmarklet();}else{document.body.appendChild(document.createElement('script')).src='http://<%= HOST %>/bookmarklet/saveit.js?';}})();">To Macabolic</a>
						</span>
					</p>
				</div>
			</div>
		</div>
	</div>

</div>
<% end %>
</body>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<title>Macabolic - <%= 'Add a new product' %></title>
	
  	<%= stylesheet_link_tag "layout.css" %>
  	<%= stylesheet_link_tag "macabolic.css" %>
  	<%= stylesheet_link_tag "reset.css" %>
  	<%= stylesheet_link_tag "scaffold.css" %>
  	<%= stylesheet_link_tag "styles.css" %>
	<%= stylesheet_link_tag "jquery-ui-1.8.17.custom.css" %>
	
	<%= javascript_include_tag "jquery.js" %>
	<%= javascript_include_tag "jquery_ujs.js" %>
	<%= javascript_include_tag "application.js" %>
	<%= javascript_include_tag "jquery.min.js" %>
	<%= javascript_include_tag "jquery.pngFix.js" %>
	<%= javascript_include_tag "jquery.ui.js" %>
	<%= javascript_include_tag "jquery-ui-1.8.17.custom.min.js" %>

  	<%= csrf_meta_tag %>

<link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
<!--[if IE 6]>
	<%= stylesheet_link_tag "ie6.css" %>
<![endif]-->
<!--[if IE 7]>
	<%= stylesheet_link_tag "ie7.css" %>	
<![endif]-->

</head>

<style type="text/css">
select {
	width: 200px;
}
.price_range {
	text-decoration: underline;
	cursor: pointer;
	color: #000000;
	margin-right: 5px;
}

.product_target_audience {
	text-decoration: underline;
	cursor: pointer;
	color: #000000;
	margin-right: 5px;
}

.selected-price {
	font-weight: bold;
	color: #DA5D18;
}

.selected-target {
	font-weight: bold;
	color: #DA5D18;
}

</style>
<script type="text/javascript"> 
    $(document).ready(function(){ 
        $(document).pngFix(); 

	    //Input Form placeholder
	    $('input:text').focus(function(){
	        if(this.value === this.defaultValue) {
	            this.value = "";
	        } else {
	            this.select();
	        }
	    })
	    .blur(function(){
	        if ($.trim(this.value) === "") {
	            this.value = (this.defaultValue ? this.defaultValue: "")
	        }
	    });
    }); 

	$(function() {
		$( "#product_name" ).autocomplete({
			source: function( request, response ) {
				$.ajax({
					url: "<%= products_path %>",
					dataType: "json",
					data: {
						search: request.term
					},
					success: function( data ) {
						response( $.map( data, function( item ) {
							return {
								label: item.product.name,
								value: item.product.name
							}
						}));
					}
				});
			},
			minLength: 2,
			select: function( event, ui ) {
				$(this).value(ui.item.label);
			},			
			open: function() {
				$(this).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
			},
			close: function() {
				$(this).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
			}
		});

		$( "#vendor_name" ).autocomplete({
			source: function( request, response ) {
				$.ajax({
					url: "<%= find_vendor_searches_path %>",
					dataType: "json",
					data: {
						query: request.term
					},
					success: function( data ) {
						response( $.map( data, function( item ) {
							return {
								label: item.vendor.name,
								value: item.vendor.name
							}
						}));
					}
				});
			},
			minLength: 2,
			select: function( event, ui ) {
				$(this).value(ui.item.label);
			},			
			open: function() {
				$(this).removeClass( "ui-corner-all" ).addClass( "ui-corner-top" );
			},
			close: function() {
				$(this).removeClass( "ui-corner-top" ).addClass( "ui-corner-all" );
			}
		});

		$("#my_collection_link img").click(function() {
			// Selected
			$(this).toggleClass('selected-product', true); 
			if ($(this).hasClass('selected-product')) {
				$(this).parents('li').removeClass('not-selected-product');
				$(this).parents('li').siblings().removeClass('selected-product');
				$(this).parents('li').siblings().addClass('not-selected-product');
				$('#my_collection_id').attr('value', $(this).attr("id"))
			} else {
				$(this).parents('li').addClass('not-selected-product');			
			}
		});
		
		$(".price_range").click(function() {
			// Selected
			$(this).toggleClass('selected-price');
			if ($(this).hasClass('selected-price')) {
				$(this).siblings().removeClass('selected-price');
				$('#product_product_link_attributes_price_range_id').attr('value', $(this).attr("id"));
			} else {
				$('#product_product_link_attributes_price_range_id').attr('value', "");
			}
		});

		$(".product_target_audience").click(function() {
			// Selected
			$(this).toggleClass('selected-target');
			if ($(this).hasClass('selected-target')) {
				$(this).siblings().removeClass('selected-target');
				$('#product_product_target_audience_id').attr('value', $(this).attr("id"));
			} else {
				$('#product_product_target_audience_id').attr('value', "");
			}
		});		
		
	});

</script>
<div class="wrapper-popup">
	<%= form_for(@product) do |f| %>
	<div class="add-product-maincol"> 	
    	<div class="add-product-content">
			<div class="add-product-methods">				
			  	<%= f.label :name %>
				<%= f.text_field :name, :class => "text", :placeholder => "e.g. iPad 3" %>
				<br/><br/>

			  	<%= f.label "Brand" %>
				<%= text_field_tag 'vendor_name', nil, :class => "text", :placeholder => "e.g. Apple Inc." %>
				<br/><br/>
				<%#= select_tag "product[vendor_id]", options_from_collection_for_select(Vendor.all, "id", "name") %>

			  	<%= f.label "Category" %>
				<%= collection_select(:product, :product_line_id, ProductLine.all, :id, :name, :prompt => true) %>
				<br/><br/>

				<%= f.label "For whom?" %>
				<% @product_target_audiences.each do |product_target_audience| %>  	
					<a class="product_target_audience" id="<%= product_target_audience.id %>"><%= product_target_audience.name %></a>
				<% end %>
				<br/><br/>

				<%= f.fields_for :product_link do |builder| %>					
				  	<%= f.label "Price" %>
					<% count = 1 %>
					<%# product_product_link_attributes_price_range_id %>
					<% @price_ranges.each do |price_range| %>
						<% if count == @price_ranges.size %>
						<a class="price_range" id="<%= price_range.id %>">$<%= price_range.from_price %>+</a>
						<% else %>
						<a class="price_range" id="<%= price_range.id %>">$<%= price_range.from_price %> - $<%= price_range.to_price %></a>
						<% end %>
						<% count = count + 1 %>
						<% if count == 5 %>
						<br/>
						<% end %>
					<% end %>
					<br/></br/>

					<%= builder.hidden_field :link %>
					<%= builder.hidden_field :informer_id %>
					<%= builder.hidden_field :price_range_id %>
					<br/><br/>
				<% end %>					

				<%= f.hidden_field :image_url %>
				<%= f.hidden_field :product_target_audience_id %>
				<%= hidden_field_tag :my_collection_id %>
				<%= hidden_field_tag "product[uploader_id]", current_user.id %>

				<div class="actions">
					<%= f.submit 'Submit', :class => "submit-tip-button" %>
				</div>
				<br/>
			</div>
	    </div>
	</div>
	<div class="sidebar"-->
		<div class="sidebar-content">
            <div class="sidebar-header">Add to your collection? [optional]</div>			
			<div id="question" class="product-grid" style="margin: 17px; border: 0px;">
		    	<ul>
				<% current_user.my_collections.each do |my_collection| %>
		  			<li id="<%= my_collection.id %>" class="not-selected-product">	
						<%= link_to '#', :id => 'my_collection_link' do %>	
							<%#= image_tag my_collection.thumbnail.url(:medium), :size => "64x64", :class => "preview-image", :id => my_collection.id, :title => my_collection.name %>
							<% if !my_collection.thumbnail.present? && !my_collection.my_collection_items.nil? && my_collection.my_collection_items.size > 0 %>
								<% if my_collection.my_collection_items[0].product.thumbnail.present? %>
									<%= image_tag( my_collection.my_collection_items[0].product.thumbnail.url(:small), :size => "64x64", :class => "preview-image", :id => my_collection.id, :title => my_collection.name) %>
								<% elsif  my_collection.my_collection_items[0].product.image_url.present? %>
									<%= image_tag( my_collection.my_collection_items[0].product.image_url, :size => "64x64", :class => "preview-image", :id => my_collection.id, :title => my_collection.name) %>
								<% else %>
									<%= image_tag "/images/product/no-image_medium.jpg", :size => "64x64", :class => "preview-image", :id => my_collection.id, :title => my_collection.name %>
								<% end %>
							<% else %>
								<%= image_tag my_collection.thumbnail.url(:small), :size => "64x64", :class => "preview-image", :id => my_collection.id, :title => my_collection.name %>						
							<% end %>							
						<% end %>
					</li>
				<% end %>
				</ul>
			</div>
			<div class="sidebar-inner">
				<hr style="width: 100%; border-top: 1px solid #d4d4d4; margin-bottom: 15px;"/>								
				<%= check_box_tag 'create_new', 'yes', false %>&nbsp;Create a new collection<br/>

				<label for="tiptitle">Name</label>
				<%= text_field_tag "my_collection_name", nil, :placeholder => "My favorites iPad cases", :class => "text" %>
				<br/><br/>				
			</div>
		</div>
	</div>


	<% end %>
</div>    	



